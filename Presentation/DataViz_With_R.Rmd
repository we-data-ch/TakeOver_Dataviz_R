---
title: "Introduction à la Visualisation de Données et à la Grammaire des Graphiques avec R"
author: " <br/>David Munoz Tord, Vestin Hategekimana, Iván Lorenci De Francisco"
date: " <br/>  `r format(Sys.Date(), '%Y-%b-%d')`"
output:
  xaringan::moon_reader:
    css: css/xaringan-themer.css
    nature:
      slideNumberFormat: "%current%"
      highlightStyle: github
      highlightLines: true
      ratio: 16:9
      countIncrementalSlides: true
      titleSlideClass: ["left", "centre", "my-title"]
---


```{r setup, echo=FALSE, fig.showtext = TRUE}
options(htmltools.dir.version = FALSE, warn = -1, message = -1, knitr.duplicate.label = 'allow')

knitr::opts_chunk$set(
  dpi=300,
  out.width = "100%",
  cache = TRUE,
  echo = FALSE,
  message = FALSE, 
  warning = FALSE,
  hiline = TRUE
)

xaringanthemer::style_mono_accent(
  base_color = "#1c5253",
  header_font_google = xaringanthemer::google_font("Josefin Sans"),
  text_font_google   = xaringanthemer::google_font("Montserrat", "300", "300i"),
  code_font_google   = xaringanthemer::google_font("Fira Mono")
)

custom_theme <- xaringanthemer::theme_xaringan(
  background_color = "#FFFFFF",
  text_font_size = 14
)

xaringanExtra::use_logo(
  position = xaringanExtra::css_position(top = "2.5em", right = "1.5em"),
  image_url = "https://wedata.ch/img/logo/wedata.png"
)

```


```{r packages-and-func, results='hide', message=FALSE, include=FALSE, warning=FALSE}
#this is to check to see if package are installed and if not to install them or just load them if they are installed!
if(!require(pacman)) {install.packages(c("pacman"))}

pacman::p_load(dplyr, dbplyr, tidyverse, hrbrthemes, xaringanthemer, kableExtra, htmltools, icons)

#The pacman package that can do this nicely. The function p_load in the package does this. The first line is just to ensure that pacman is installed.


#htmtools wrapper
image_link <- function(image,url,...){
  htmltools::a(
    href=url,
    htmltools::img(src=image,...)
    )
}
```


```{r ,  fig.align="center"}
url <- "./img/wedata.png"
urlLink <- "https://www.youtube.com/channel/UCGktdbvbc_H-JEkYYTvwRVw"
image_link(url,urlLink, width = "900px")

```

---

# Qui sommes-nous?


<div style="display: flex; align-items: center; margin-bottom: 50px;">
  <img src="https://wedata.ch/img/team/DMT_pic_square.png" alt="David" width="100" height="100 "style="margin-right: 50px;">
  <div>
    <strong> David Muñoz Tord </strong>: Data Scientist et développeur R (Ancien doctorant en Neurosciences Computationnelles à l'UniGE)
  </div>
</div>


<div style="display: flex; align-items: center; margin-bottom: 50px;">
  <img src="https://wedata.ch/img/team/vestin.webp" alt="Vestin" width="100" height="100" style="margin-right: 50px;">
  <div>
   <strong>Vestin Hategekimana </strong>: Doctorant en Démographie à l'UniGE passionné de statistique et de programmation.
  </div>
</div>


<div style="display: flex; align-items: center;  margin-bottom: 50px;">
  <img src="https://media.licdn.com/dms/image/C4D03AQGgEsuLz0oX6g/profile-displayphoto-shrink_800_800/0/1585054960331?e=1704931200&v=beta&t=R67KbRAEuLjfdkCULU6Z71VmIUG8Xyvuy3oWE_pcfnc" alt="Ivan" width="100"  height="100" style="margin-right: 50px;">
  <div>
    <strong> Ivàn Lorenci De Francisco </strong>: Master en Science Politique, réalisant un certificat en  Statisitques Appliqués à l'UniGE. Intérêt pour les statistiques et le text mining.
  </div>
</div>

<a href="https://we-data-ch.github.io/TakeOver_Dataviz_R/Presentation/DataViz_With_R.html">
`r icons::icon_style(icons::fontawesome("link"), fill = "#1c5253")` Lien vers cette presentation !
</a>     
<a href="https://github.com/we-data-ch/TakeOver_Dataviz_R">
`r icons::icon_style(icons::fontawesome("link"), fill = "#1c5253")` Lien vers le repo, code et exercices !
</a>



---

# Plan


.pull-left[

**Partie 1a (08:30 - 09:20)** *David*
- Grammaire des graphiques
- Implémentation avec ggplot2

**Pause (09:20 - 09:30)**

**Partie 1b (09:30 - 09:50)** *Vestin*
- Implémentation avec ggplot2 (suite)

**Partie 2 (09:50 - 10:40)** *Iván*
- Design de graphique (+exploration)
     - Labels / Texte
     
]

.pull-right[
**Pause (10:40 - 10:50)**

**Partie 3 (10:50 - 11:40)** *Vestin*
- Choix du graphique
- Lire la documentation
- Exercices - reproduire des graphiques

**Pause (11:40 - 11:50)**

**Partie 4 (11:50 - 12:00)** *Tous*
- Conclusions
- Ressource + Documentation
- Interactivité

]



<!--comments -->
???

On va essayer de ce fixer a ce plan mais c'est tres probable qu'on deborde un peu partout.

Hésitez pas a demandez si vous avez envie d'une pause.

---

# But

- Tentative d'inciter les gens à en savoir plus par eux-mêmes

- Partager notre point de vue personnel sur la raison pour laquelle la grammaire des graphiques domine pour la plupart des ensembles de données




```{r ,  fig.align="left"}
url <- "./img/graphs.png"
image_link(url,url,width="1000px")
```


<!-- comments -->

???

Ce cours n'est pas une introduction à R, mais une introduction à la visualisation de données avec R. 

De plus, ce cours ne pourra pas etre une exaustif quant a l'utilisation de ggplot2 car cela pourrait prendres des jours, mais il vous donnera les bases pour commencer à explorer et à créer vos propres graphiques.

Ce cours a plutot pour but d'inciter les gens à en savoir plus par eux-mêmes et de partager notre point de vue personnel sur la raison pour laquelle la grammaire des graphiques domine pour la plupart des ensembles de données


---

class: inverse center middle

# Grammaire des Graphiques

<!-- comments -->

???

bref description de la grammaire des graphiques

---

## Grammaire des Graphiques


- La grammaire des graphiques est un framework pour construire des **graphiques en couches**, en utilisant des **composants de base** pour construire des graphiques plus complexes



## Pourquoi?

- Framework **agile** pour l'exploration des données

- Permet de créer des **graphiques complexes avec peu de code**

- **Géneralise facilement** à de vaste ensemble de variables avec des hiérarchies complexes

<!-- comments -->

???

La gramamire des graphiques est un framework pour construire des graphiques en couches, en utilisant des composants de base pour construire des graphiques plus complexes.

Pourquoi utiliser la grammaire des graphiques?
Alors parce que c'est un framework agile pour l'exploration des données, qui permet de créer des graphiques complexes avec peu de code, et qui géneralise facilement à de vaste ensemble de variables avec des hiérarchies complexes



---

class: inverse center middle

# Dataviz: Théorie


<!-- comments -->

???

Passons maintenant à la théorie de la visualisation de données.

---


## Dataviz, un univers de possibilités

- On va **essayer** de faire un aperçu général de tous les **genre** de graphiques que l'on peut faire. 

  - **Distribution**: Histogramme, Densité, Boxplot, Violin, etc.
  - **Relation**: Scatterplot, Corrélogramme, heatmap, etc.
  - **Ranking**: Barplot, Spider chart, Parrallel, etc.
  - **Evolution**: Line Chart, Area Chart, etc.
  - **Partie d'un tout**: Treemap, Pie Chart, Doughnut, etc.
  - **Cartographie**: Choropleth, Bubble Map, etc.
  - **Réseau**: Network, Sankey, etc.


<!--comments-->

???

On va essayer de faire un aperçu général de tous les genre de graphiques que l'on peut faire. Pas de code ou de synthaxe pour l instant, juste des images pour vous montrer ce que l'on peut faire.

On peut faire 7 Meta categories de graphiques: Distribution, Relation, Ranking, Evolution, Partie d'un tout, Cartographie, Réseau. On va maintenant les explorer un par un.

Je m'excuse d'avance pour les anglicismes, mais je trouve que les mots en anglais sont plus clairs et plus précis que les mots en français souvent pour ce domaine.

Hesitez pas à poser des questions sur les graphiques que je vais montrer, je vais aller assez vite pour pouvoir montrer le plus de graphiques possible mais je peux revenir en arrière si vous avez des questions.


---

#### Distribution: Visualiser la tendance d'une ou plusieurs variables numériques

.pull-left-small[

```{r ,  fig.align="center"}
url <- "./img/Distrib.png"
image_link(url,url,width="200px")

```
]

.pull-right-large[

- **Violin plot**: un hybride entre un boxplot en boîte et un density plot

<br>
- **Density plot**: les proportions de valeurs dans un intervalle continu

<br>
- **Histogram**: la fréquence des données en utilisant des intervalles de largeur égale (bins)

<br>
- **Boxplot**:  résume la distribution des données (médiane, quartiles, valeurs aberrantes)

]


<!--comments-->

???

on commence avec les graphiques de distribution, qui permettent de visualiser la tendance d'une ou plusieurs variables numériques.

- Les violin plot sont particulièrement adaptés lorsque la quantité de données est importante et qu'il est impossible de montrer des observations individuelles. on ajoute souvent un boxplot au milleu pour montrer la médiane et les quartiles.

- Les histogrammes et les graphique de densité sont tous deux utiles pour visualiser la distribution des données, mais ils montrent des choses légèrement différentes. Les histogrammes montrent les frequences, tandis que les diagrammes de densité montrent les proportions.

- Un boxplot montre la distribution des données quantitatives d'une manière qui facilite les comparaisons entre les variables ou entre les niveaux d'une variable catégorielle.

En detail: 
La ligne qui divise la boîte en deux parties représente la médiane. Les extrémités de la boîte indique les quartiles supérieur et inférieur. Les lignes extrêmes indiquent la valeur la plus élevée et la plus basse, apres cela on vois des  valeurs aberrantes/ outliers

/ Attention! Le boxplot cache la taille de l'échantillon de chaque groupe, il faut l'afficher avec une annotation le n. / !


un petit conseil:
Ordonner votre boxplot/violin plot par la médiane peut le rendre plus efficace


---

#### Relation: Relation entre 2 variables numériques/continues

.pull-left-small[

```{r ,  fig.align="center"}
url <- "./img/Corre.png"
image_link(url,url,width="200px")

```
]

.pull-right-large[


- **Scatter plot**: relation entre deux variables numériques

<br>

- **heatmap**: valeurs individuelles dans une matrice représentées par des couleurs

<br>
- **correlogram**:  une matrice, où chaque point représente la corrélation entre deux variables

<br>
- **bubble plot**:  un nuage de points avec une troisième variable numérique associée à la taille du cercle

]


<!--comments-->

???

maintenant on va voir les graphiques de relation, qui permettent de visualiser la relation entre 2 variables continues.

- Les scatter plot sont la version la plus simple et la plus utilisée pour visualiser la relation entre deux variables continues. Ils sont particulièrement utiles pour identifier les valeurs aberrantes/outlier et les tendances. N'oubliez pas de montrer les sous-groupes si vous en avez.

Ici le "Overplotting" est l'erreur la plus fréquente, c'est lorsque la taille de l'échantillon est élevée et que les points se chevauchent. Il existe plusieurs solutions pour cela, comme les jitter, les alpha, les contours, etc quon verra plus en detail plus tard.

Pensez aux échelles (log, sqrt, etc.) ! Et où elles commencent , a 0 ou autre chose ? On en reparlera plus tard en detail

heatmap : C'est un peu comme regarder un tableau de données depuis le haut. Les valeurs individuelles dans une matrice sont représentées par des couleurs. Les couleurs peuvent être utilisées pour représenter des valeurs numériques discrètes ou continues. Il faut souvent normaliser les données pour que les couleurs soient comparables. 


correlogram: C'est une matrice, où chaque point représente la corrélation entre deux variables. Les couleurs sont utilisées pour représenter la force de la corrélation. 

Pour ces deux dernier type / ! La palette de couleurs est importante  on revient dessus dans la prochaine slide/ !

bubble plot: C'est un nuage de points avec une troisième variable numérique associée à la taille du cercle. Il est utile pour visualiser les relations entre trois variables.

N'oubliez pas une légende pour la taille des bulles ! On va voir pourquoi dans les prochaines slides aussi


---

#### Pallette de couleurs

.pull-left[

```{r ,  fig.align="center"}
url <- "https://blog.datawrapper.de/wp-content/uploads/2021/03/full-210101_colorscales24-768x178.png"

image_link(url,url,width="600px")
```

- Quand utiliser des échelles de couleurs séquentielles et quand utiliser des échelles de couleurs divergentes ?

**Rule of thumb**: S'il existe une valeur intermédiaire significative, utilisez des couleurs divergentes. Sinon, utilisez des couleurs séquentielles.

]

.pull-right[

```{r ,  fig.align="center"}
url <- "https://blog.datawrapper.de/wp-content/uploads/2021/03/full-210101_colorscales39-1024x435.png"
image_link(url,url,width="600px")
```
]


<!-- comments -->

???

Et les couleurs doivent être choisies avec soin pour qu'elles soient interprétables.

S'il existe une valeur intermédiaire significative, utilisez des couleurs divergentes. Il peut s'agir de

- zéro, par exemple la croissance économique positive et négative
- 50 %, par exemple le vote entre deux choix
- la moyenne ou la médiane, par exemple l'âge inférieur et supérieur à l'âge médian
- un objectif, par exemple des revenus inférieurs et supérieurs à l'objectif trimestriel



---

#### Pourquoi les graphiques en 3D sont une mauvaise idée ?

.pull-left[
```{r ,  fig.align="right"}
url <- "./img/failureCircle.png"
image_link(url,url,width="800px")

```

]

.pull-right[

#### Pouvez-vous identifier le problème avec ce graphique en 3D?

```{r ,  fig.align="center"}

url <- "https://miro.medium.com/v2/resize:fit:720/format:webp/1*44jIdwGAialtNdCljjoh6g.png"
image_link(url,url,width="800px")

```

]

<!--commemnts -->

???

n'utilisez jamais le graphique à bulles 3D parce qu'il s'échelonne quadratiquement !

La perspective est également la pire chose que l'on puisse faire à un graphique, car les objets les plus éloignés semblent plus petits, mais notre cerveau les perçoit comme étant plus grands qu'ils ne le sont.

Les deux camemberts représentent des données identiques. Dans le diagramme à secteurs en 2D, il est facile de voir que les couleurs bleue et grise (pommes et bananes) sont de taille égale. 

Dans le diagramme en 3D, en revanche, le gris semble beaucoup plus grand que le bleu. En outre, le gris et le rose foncé semblent de taille égale en 3D, tandis que le bleu apparaît comme le plus petit. Nous percevons donc 3 choses de manière incorrecte dans le diagramme circulaire en 3D. Cela est dû au principe de la distorsion de la perspective.

---

#### Ranking: Comparer des valeurs numériques (unique ou moyenner) entre elles

.pull-left-small[

```{r ,  fig.align="center"}
url <- "./img/Ranking.png"
image_link(url,url,width="200px")

```
]

.pull-right-large[

- **Barplot**: chaque valeur de la variable catégorielle est représentée par une barre

<br>
- **Spider plot**: chaque variable a son propre axe, tous les axes sont reliés au centre de la figure

<br>
- **Wordcloud**: affiche une liste de mots, l'importance de chacun étant indiquée par la taille ou la couleur de la police

- **Parralel plot**: chaque observation est représentée par une ligne traversant une série d'axes parallèles, correspondant à une variable ou à une dimension spécifique 


]


<!--comments-->

???

Ranking : Comparer des valeurs numériques (unique ou moyenner) entre elles

Barplot a ne pas confondre avec un histogramme. 

Dans un barplot la distance entre les barres n'a pas de d'importance, alors que la distance entre les barres dans un histogramme est importante.

Des noms tres longs ? Pensez à une version horizontale du bar chart.

un autre petit truc:
trier son barplot permet souvent de mieux comprendre la situation!


Le spider plot / radar est un type de graphique bidimensionnel conçu pour représenter une ou plusieurs séries de valeurs sur plusieurs variables quantitatives communes. Chaque variable possède son propre axe, tous les axes étant reliés au centre de la figure.

Le spider chart est souvent critiqué dans la dataviz, et ce n'est probablement pas la meilleure façon de transmettre l'information. Vous pouvez souvent utiliser un graphique parralle ou un bar plot à la place qui permet de mieux comparé les valeurs.

Les wordcloud sont hype, mais ils déforment souvent la réalité et ne sont pas très effiace. Par exemple, les mots longs seront plus visibles etc..
Utiliser plutôt un bar  plot horizontal trier si vous avez peu de valeurs.

Le graphique parallèle permet de visualiser plusieurs dimensions à la fois. Il est souvent préférable au graphique en araignée, car les valeurs sont plus faciles à comparer lorsqu'elles sont disposées le long d'un seul axe vertical ou horizontal. 


---

#### Partie d'un tout: illustrer des proportions numériques

.pull-left-small[

```{r ,  fig.align="center"}
url <- "./img/Part.png"
image_link(url,url,width="200px")

```
]

.pull-right-large[

- **treemap**: chaque groupe est représenté par un rectangle dont la surface est proportionnelle à sa valeur

- **Venn diagramme**: chaque ensemble est représenté par un cercle, la taille du cercle représente l'importance du groupe, l'intersection des cercles indique les points communs entre les groupes

- **doughnut and pie chart**: un cercle divisé en secteurs qui représentent chacun une proportion de l'ensemble


.pull-left[


- **stacked bar chart**: chaque barre est divisée en segments qui représentent chacun une proportion de l'ensemble.

]


.pull-right[
```{r ,  fig.align="center"}

url <- "https://i.stack.imgur.com/5WeCu.png"

image_link(url,url,width="200px")

```
]
]


<!--comments-->

???

Partie d'un tout, pour illustrer des proportions numériques.

Treemaps ont l'avantage d'utiliser efficacement l'espace, ce qui les rend utiles pour représenter une grande quantité de données. Mais n'annotez pas plus de 3 niveaux de la hiérarchie, cela rendrait la figure illisible.

Diagramme de Venn :  Chaque ensemble est représenté par un cercle, la taille du cercle représente l'importance du groupe, l'intersection des cercles indique les points communs entre les groupes.
N'utilisez pas plus de 3 ensembles, cela commence a rendre la figure illisible.

Les pie chart sont très critiqués et doivent être évités autant que possible. L'être humain est très mauvais pour traduire des angles en valeurs. et comme on la vue, la 3D les rends pire

Pourquoi ne pas plutôt envisager un stacked percentage bar plot ? chaque barre est divisée en segments qui représentent chacun une proportion de l'ensemble.

---

#### Evolution: Montrer des tendances temporelles pour ou plusieurs variables numeriques

.pull-left-small[

```{r ,  fig.align="center"}
url <- "./img/Evo.png"
image_link(url,url,width="200px")

```
]

.pull-right-large[

- **line plot**: chaque observation est représentée par un point, les points sont reliés par des lignes

- **area plot**: extension d'un line plot, la zone entre l'axe des x et la ligne est rempli par une couleur

<br>
- **stacked area et streamcharts**: extension d'un area plot, les zones sont empilées les unes sur les autres pour montrer l'évolution de plusieurs groupes


]


<!--comments-->

???

Evolution: Montrer des tendances temporelles pour ou plusieurs variables numeriques

Lineplot / graphique linéaire: il est similaire à un scatter plot, à ceci près que les points de mesure sont ordonnés (généralement en fonction de leur valeur sur l'axe des x) et reliés par des segments de ligne droite. Un graphique linéaire est souvent utilisé pour visualiser une tendance dans les données sur des intervalles de temps - une série chronologique

Attention au graphique spaghetti : trop de lignes rendent le graphique illisible !

Area chart: est une extension d'un line plot, la zone entre l'axe des x et la ligne est rempli par une couleur. Je suis un grand fan des area chart et je pense qu'ils rendent la tendance plus évidente que l'utilisation d'un lineplot souvent.

Stacked area : une extension d'un area plot, les zones sont empilées les unes sur les autres pour montrer l'évolution de plusieurs groupes. il peut être difficile de lire l'évolution d'un groupe spécifique. L'ordre des groupes (de bas en haut) peut avoir une influence! 

Streamgraph (Graphique en flux) : il n'y a pas de coin : les bords sont arrondis, ce qui donne une belle impression de flux. 

Bon pour étudier les proportions relatives de l'ensemble.

---


#### Cartographie: Visualiser des données géographiques

.pull-left-small[

```{r ,  fig.align="center"}
url <- "./img/Cart.png"
image_link(url,url,width="200px")

```
]

.pull-right-large[

- **carte**: projection de coordonnées géographiques sur une carte

<br>
- **choropleth**:  chaque région est colorée en fonction de la valeur d'une variable

<br>
- **hexbin map**: chaque région est remplie de petits hexagones, la couleur de l'hexagone indique la valeur d'une variable

<br>
- **cartogram**: chaque région est redimensionnée en fonction de la valeur d'une variable

]


<!--comments-->

???

Les cartes sont un excellent moyen de visualiser des données géographiques. je ne vais pas m'attarder dessus car c'est un sujet à part entière. mais en bref:

**carte choroplèthe** : chaque région est colorée en fonction de la valeur d'une variable,

La **carte hexagonale** est une sorte de carte choroplèthe. Elle supprime le biais introduit par la taille différente des régions dans la carte choroplèthe, puisque chaque région est représentée par le même hexagone.

Le **cartogramme** distort la carte en fonction de la valeur d'une variable , cela vise à corriger les biais : lorsqu'une variable est agrégée par région, une région avec très peu de points de données semblera aussi importante qu'une région avec beaucoup de points de données.


---


#### Réseaux: Visualiser des relations entre des entités (noeuds et liens)

.pull-left-small[

```{r ,  fig.align="center"}
url <- "./img/Network.png"
image_link(url,url,width="200px")

```
]

.pull-right-large[

- **chord diagram**: chaque entité est représentée par un arc, la taille de l'arc est proportionnelle à la valeur d'une variable


- **graph diagram**: la taille des noeuds et des arcs est proportionnelle à la valeur d'une variable

<br>
- **Sankey  diagram**: plusieurs entités (nœuds) sont représentées par des rectangles, la relation entre ces entités est représentée par des liens proportionnels à une valeur

- **arc diagram**: nœuds sont affichés le long d'un axe unique et les liens sont représentés par des arcs

]


<!--comments-->

???

Réseaux: Visualiser des relations entre des entités (noeuds et liens)

Les réseaux constituent un domaine de recherche à part entière aussui. Les diagrammes de réseaux ne sont pas faciles à comprendre. Donc pensez a donnez beaucoup d'explications à votre public lorsque vous les présentez.
Attention à l'encombrement et à l'absence de connexions faibles ?

Chord graph: chaque entité est représentée par un arc, la taille de l'arc est proportionnelle à la valeur d'une variable. L'ordre des groupes autour du cercle est important, il est préférable de minimiser le nombre d'arcs qui se croisent.

**graph**: la taille des noeuds et des arcs est proportionnelle à la valeur d'une variable. Il existe plusieurs types de graphs diagrams Ils peuvent être dirigés (flux) ou non-dirigés (connexion). Les liens peuvent être mis en évidence ou non.

**Sankey diagrams** : plusieurs entités (nœuds) sont représentées par des rectangles, la relation entre ces entités est représentée par des liens proportionnels à une valeur, cela permet de visualiser les flux. 


**arc diagram**: nœuds sont affichés le long d'un axe unique et les liens sont représentés par des arcs, cela  permet de mettre en évidence les clusters en 2D

---

class: inverse center middle

# Quiz #1

<!-- comments -->

???

Ok pfiou, on a fait le tour du monde des graphiques. Maintenant, un petit quiz pour voir comment vous refléchissez à la visualisation de données.

---

## Quiz #1


- Quel type de graphique est le plus adapté pour visualiser la relation entre deux variables continues (e.g. taille et poids) ?
--
 **Scatter plot/ Diagramme de dispersion**
--

- Quel type de graphique est le plus adapté pour comparer visuellement la distribution de deux variables continues avec beaucoup de points (e.g. age d'une population par sexe) ?
--
 **Violon plot / boxplot**
--

- Quel type de graphique est le plus adapté pour visualiser la corrélation entre **toutes** les variables d'un dataset ?
--
 **Correlogram **
--

- Quel type de graphique est le plus adapté pour visualiser l'évolution de la température moyenne en Suisse au cours des 50 dernières années ?
--
 **Line plot/ area plot**
--

- Quel type de graphique est le plus adapté pour visualiser la répartition des ventes de voitures par marque ?
--
 **Bar plot**
--
 / Et par marque et par année ?
--
 **(Stacked) bar plot empilé**
--

- Quel type de graphique est le plus adapté pour visualiser les relations entre les pays de l'UE ?
--
 **Graph diagram**

 

 
---


class: inverse center middle

# Implémentation: GGplot2 

<!-- comments -->

???

On souffle un peu et on passe à l'implémention de ces graphiques en R avec ggplot2. pour l'instant on se concentre sur la syntaxe du coup pas besoin de coder de votre coté, on fera des exercices plus tard.

---

## GGplot2 

.pull-left-large[

- GGplot2 est une implémentation de la grammaire des graphiques en R, crée par Hadley Wickham. 

<br>
- Vous fournissez les données, dites à ggplot2 comment faire correspondre les variables à l'esthétique, quelles graphiques utiliser, et il s'occupe des détails.

<br>
- Disponible sur R [ggplot2](https://ggplot2.tidyverse.org/) et Python [plotnine](https://plotnine.readthedocs.io/en/v0.12.3/)


]


.pull-right-small[
```{r ,  fig.align="right"}

url <- "https://camo.githubusercontent.com/a6cc89d06ac569b886318ed743f16cdbcf0f2fe7bce5804bdcd1c160b99797f2/687474703a2f2f692e696d6775722e636f6d2f4472496c522e706e67"
image_link(url,url,width="270px")

```
]

<!--comments-->

???

- GGplot2 est une implémentation de la grammaire des graphiques en R, crée par Hadley Wickham. 

- Vous fournissez les données, dites à ggplot2 comment faire correspondre les variables à l'esthétique, quelles graphiques utiliser, et il s'occupe des détails.

- Disponible sur R et python (appellé) plotnine

Imaginer React /Vue vs Vanilla JS. quelqu'un fais du web ? 

Moi je suis pas trop web developper, mais j'ai du faire des site pour des amis/associations. Et j'ai evidemment commencé en vanilla JS et ca me suffisait pour faire des petits trucs simple.. Et apres mes potes devs mont dit de passer sur React ou Vue. Et au debut j'ai trouvé ca trop compliqué ca me rendais fou cest components partout. Mais apres avoir compris le truc, j'ai trouvé ca beaucoup plus simple, puissant et je peux reutiliser beaucoup de code partout sans avoir a me soucier des details.


---

## Syntaxe de GGplot2


.pull-left-large[

- **Data**: Les données à utiliser pour créer le graphique
- **Aesthetic**: Les caractéristiques visuelles du graphique
- **Geom**: La géométrie qui représente les données
- **Scale**: Comment les caractéristiques visuelles sont converties en valeurs d'affichage
- **Statistics**: Transformations statistiques. Comptes, Moyennes, etc.
- **Coordinates**: Système numérique pour déterminer la position de la géométrie. Cartésien, Polaire, etc.
- **Facets**: Diviser les données en sous-ensembles
- **Theme**: Personnalisation des éléments non liés aux données

]

.pull-right-small[
```{r ,  fig.align="right"}
url <- "https://nbisweden.github.io/RaukR-2019/ggplot/presentation/ggplot_presentation_assets/gog.png"
image_link(url,url,width="240px")


url <- 'https://nbisweden.github.io/RaukR-2019/ggplot/presentation/ggplot_presentation_assets/syntax.png'

image_link(url,url,width="370px")
```
]



<!-- comments -->

???

Voyons voir la syntaxe de ggplot2. Elle se consiste de differents couches: Les data (les données à utiliser pour créer le graphique), les esthétiques (les caractéristiques visuelles du graphique), la géométrie (la forme qui représente les données), les échelles (comment les caractéristiques visuelles sont converties en valeurs d'affichage), les statistiques (transformations statistiques. Count, Moyennes, etc.), les coordonnées (système numérique pour déterminer la position de la géométrie. Cartésien, Polaire, etc.), les facettes (diviser les données en sous-ensembles), et le theme (personnalisation des éléments non liés aux données).

On va maintenant passer en revue ces couches une par une.

---

class: inverse center middle

# Familiarisation

<!-- comments -->

???

On va commencer par se familiariser avec ggplot2. On va voir comment créer un graphique simple, et comment ajouter des couches pour le personnaliser.

---


## Données sur le taux de suicide (1985- 2016)

```{r, echo=FALSE}

##suicide rate data
df <- read.csv("data/suicides.csv") 


kable(df[1:100, ],format="html",escape = F, col.names = colnames(df)) %>% 
  kable_styling() %>%
  kableExtra::scroll_box(width = "100%", height = "400px")
```


<!--comments-->

???

Voici un jeux de données que je vais utiliser pour illustrer mes propos. Il consiste en des données demographiques sur les taux de suicides dans différents pays entre 1995 et 2016. Je sais pas tres joyeux .. mais super indicatif pour ce qu'on va faire. (vous pouvez trouvez le jeux de données ainsi que tout le code de ce cours sur le repo de github


---

## Basic R VS GGplot2

.pull-left[
```{r , eval=FALSE, echo=TRUE}

plot(df$population, df$suicides_no) # Basic R
```

```{r ,  fig.align="left", out.width="400px", out.height="400px"}

# Basic R 
plot(df$population, df$suicides_no)

```

]

.pull-right[
```{r , eval=FALSE, echo=TRUE}
ggplot(data=df, mapping=aes(x=population, 
                            y=suicides_no)) + 
  geom_point() # ggplot2
```


```{r ,  fig.align="left", out.width="340px", out.height="340px"}

# ggplot2
ggplot(df, aes(x=population, y=suicides_no)) +
  geom_point() +
  theme_xaringan(background_color = "#FFFFFF")

```

]

<!--comments -->
???

Basique R vs ggplot2. On va commencer par faire un graphique simple avec les deux methodes.

Ce sont tous les deux des graphiques de dispersion, 
mais deja ggplot2 me parait plus facile a lire et a comprendre

En quelque mots, le premier parametre est le dataframes, le deuxieme est aes qui est un objet qui contient les variables que l'on veut utiliser pour le graphique, ici x pour l'axe des abscisses et y pour l'axe des ordonnées,

et le troisieme est la geometrie du graphique, ici un graphique de point AKA dispertion

---


## Comment colorer les points par sexe?

- Traditionnellement, on utilisait le fromat **wide** des données pour les graphiques groupés

```{r , eval=T, echo=F}
df_wide <- df %>% 
  pivot_wider(values_from = c("population", "suicides_no"),
              names_from = "sex",
              id_cols = c("country", "year", "age"))

kable(df_wide[1:100, ],format="html",
      escape = F, col.names = colnames(df_wide)) %>% 
  kable_styling(font_size=16) %>%
  kableExtra::scroll_box(width = "100%", height = "400px")

```

<!--comments  -->

???

Comment colorer les points par sexe? traditionnellement, on utilisait le fromat wide des données pour les graphiques groupés voici a quoi ca ressemble, une colonne pour les femmes et une colonne pour les hommes


---
## Old school way

.pull-left-large[
```{r , eval=FALSE, echo=TRUE}
# Basic R

# D'abord une premiere couche avec les femmes
plot(df_wide$population_female, 
     df_wide$suicides_no_female, col="blue") 

# après on ajoute les hommes
points(df_wide$population_male, 
       df_wide$suicides_no_male, col="red") 
```
]

.pull-right-small[

```{r ,  fig.align="left", out.width="400px", out.height="400px"}

# Basic R 
plot(df_wide$population_male, df_wide$suicides_no_male, col="blue") #Basic R
points(df_wide$population_female, df_wide$suicides_no_female, col="red") 

```

]

<!--comments  -->
???

La maniere traditionelle de faire ca, c'est de faire un graphique avec les femmes, puis d'ajouter les hommes par dessus.
Stupide et compliqué.. et pas du tout scalable si on a vraiment plein de groupes

---

## GGplot2 way

- **ggplot2** utilise le format 'long' pour les graphiques groupés (reminder)

- une columne = une variable !

```{r, echo=FALSE}

kable(df[1:100, ],format="html",escape = F, col.names = colnames(df)) %>% 
  kable_styling() %>%
  kableExtra::scroll_box(width = "100%", height = "300px")
```


<!--comments  -->
???

miantenant on va faire la meme chose avec ggplot2, on va utiliser le format long (les data comme on les avait dans la premiere slide/ non modifié), une colonne = une variable/une information, c'est aussi ce qu'on appelle tidy data (qui veux dire données rangées).

---

## Comment colorer les points par sexe?

.pull-left[
```{r , eval=FALSE, echo=TRUE}
ggplot(df, aes(x=population, 
               y=suicides_no, 
               color=sex)) +
geom_point()
```
]


.pull-right[

```{r ,  fig.align="left", out.width="500px", out.height="400px"}

ggplot(df, aes(x=population, y=suicides_no, color=sex)) +
  geom_point() +
  custom_theme

```

]

<!--comments  -->
???

Deja la syntaxe est plus simple, on a pas besoin de specifier les variables a chaque fois, on peut les specifier une fois pour toute dans aes.

On rajoute juste un nouveau mapping, ici "color" et bam tout le reste est fait pour nous! Pas sympa ca?

---

class: inverse center middle

# Aesthetics 

Les rouages de ggplot2

<!--comments  -->
???

Allons voir un peu plus en details comment ca marche

---

## Aesthetics

Les aesthetics sont le **mapping des variables**, c'est ce qui permet de rajouter de **l'information/ des dimensions au graphique**, on peut en rajouter autant qu'on veut, mais il faut que ca reste lisible.

  -   **x** pour l'axe des abscisses
  -   **y** pour l'axe des ordonnées
  -   **z** poour l'axe des profondeurs
  -   **color** pour la couleur (les bords)
  -   **size** pour la taille
  -   **shape** pour la forme
  -   **alpha** pour la transparence
  -   **linetype** pour le type de ligne
  -   **fill** pour le remplissage
  -   et plein d'autres encore...
    
<!--comments-->

???
- **aes** est un objet qui contient les variables que l'on veut utiliser pour le graphique, c'est qu'on pourrait comparer aux dimentions du graphiques. Par exemple x et y sont les dimentions principales, et color, size, shape, alpha, linetype, fill sont des dimentions secondaires qui permettent de rajouter de l'information au graphique en plus de trois dimentions de bases. Vous captez ?

---


## Colorer par pays? Easy

.pull-left[
```{r , eval=FALSE, echo=TRUE}
ggplot(df, aes(x=population, 
               y=suicides_no, 
               color=country)) +
geom_point()
```
]


.pull-right[

```{r ,  fig.align="left", out.width="500px", out.height="400px"}

ggplot(df, aes(x=population, y=suicides_no, color=country)) +
  geom_point() +
  custom_theme

```

]

<!--comments  -->
???

maintenant admettons qu'on veut colorer par pays, c'est aussi simple que de changer le mapping de color par country!

La maniere traditionnelle de faire des graphiques groupés aurait demandé de recodé le tout (pas flexible)

---

## Forme par pays? Pfff..

.pull-left[
```{r , eval=FALSE, echo=TRUE}
ggplot(df, aes(x=population, 
               y=suicides_no, 
               shape=country)) +
geom_point()
```
]


.pull-right[

```{r ,  fig.align="left", out.width="500px", out.height="400px"}

ggplot(df, aes(x=population, y=suicides_no, shape=country)) +
  geom_point() +
  custom_theme

```

]

<!--comments  -->
???

maintentant tu veux changer la forme par pays?
Pff.. en un claquement de doigt, il faut juste changer color par shape et voila ! 

---

class: inverse center middle

# Geoms 

Le lexique des graphiques

<!--comments  -->
???

Maintenant que vous savez comment mapper des dimensions aux graphiques, on va voir les differents types de graphiques que l'on peut faire avec ggplot2

---

## Geoms 

- Les **geoms** sont les élements géometrics qui vont **reprensenter** les données
    -   ** geom_point()** pour les nuage de points
    -  **geom_line()** pour les lignes
    -   **geom_bar()** pour les barres
    -   **geom_boxplot()** pour les boites à moustaches
    -   **geom_histogram()** pour les histogrammes
    -   **geom_density()** pour les densités
    -   **geom_smooth()** pour les courbes de tendances
    -  **geom_area()** pour les aires
    - **geom_violin()** pour les violons
    -   et plein d'autres encore...
  
  
```{r ,  echo=TRUE, eval=FALSE}
help.search("^geom_",package="ggplot2") 
```


<!--comments-->

???
geom viens de geometric object si jamais 

- Les **geoms** sont les élements géometrics qui vont **reprensenter** les données

il y a des dizaines de geoms dans ggplot2, on va en voir quelques uns aujourd'hui mais si vous voules une liste exhaustive, vous pouvez faire typer cette ligne de code sur R



---

## Exemples

```{r ,  fig.align="left", out.width="500px", out.height="400px"}
url <- 'https://nbisweden.github.io/RaukR-2019/ggplot/presentation/ggplot_presentation_assets/geoms.png'

image_link(url,url,width="1070px")
```


<!-- comments -->

???

On en a deja vu quelques unes, mais il y a en des centaines d'autres

point histogram et density sont les plus courants..

---

## Regression par pays

.pull-left[
```{r , eval=FALSE, echo=TRUE}
ggplot(df, aes(x=population, 
               y=suicides_no, 
               color=country)) +
geom_point() + 
geom_smooth() 
# on rajoute une courbe de tendance
```
]


.pull-right[

```{r ,  fig.align="left", out.width="500px", out.height="400px"}

ggplot(df, aes(x=population, 
               y=suicides_no, 
               color=country)) +
geom_point(alpha=0.3) + 
geom_smooth(method="lm", formula=y~x) +
  custom_theme

```

]

<!--comments  -->
???
Maintenant on va voir comment faire une regression pour chaque pays

On rajoute just une courbe de tendance (geom smooth).
Donc on voit qu'on peut rajouter des geoms a la suite, et que les geoms sont cumulatifs.


---


## Regression pour l'ensemble des pays



.pull-left[
```{r , eval=FALSE, echo=TRUE}
ggplot(df, aes(x=population, 
               y=suicides_no)) +
geom_point(aes(color=country)) + 
geom_smooth() 
# on rajoute une courbe de tendance
```

- On peut séparer les geoms individuelement !


]


.pull-right[

```{r ,  fig.align="left", out.width="500px", out.height="400px"}

ggplot(df, aes(x=population, 
               y=suicides_no)) +
geom_point(aes(color=country), alpha=0.3) + 
geom_smooth(method="lm", formula=y~x) +
  custom_theme

```

]

<!--comments  -->
???

Mais si on enlevent le color de aes, on peut le mettre dans la couche du geom_point et ca va colorer/grouper les points par pays mais pas la courbe de tendance. elle, Elle reste globale.

Attention l'ordre compte!

---

## Analogie anatomique


.pull-left[
```{r , eval=FALSE, echo=TRUE}
ggplot(df, aes(x=population, 
               y=suicides_no, label = age)) +
geom_point(aes(color=country)) 






ggplot(df, aes(x=population, 
               y=suicides_no, label = age)) +
geom_text(aes(color=country)) 
```


]


.pull-right[

```{r ,  fig.align="left", out.width="500px", out.height="400px"}

x <- ggplot(df, aes(x=population, 
               y=suicides_no, label = age)) +
geom_point(aes(color=country)) +
  custom_theme



y <- ggplot(df, aes(x=population, 
               y=suicides_no, label = age)) +
geom_text(aes(color=country)) +
  custom_theme

gridExtra::grid.arrange(x,y,nrow=2)
```

]

<!--comments  -->
???

L'analogie est celle des genes et de l'environnement. L'aes sont les genes, les geoms sont l'environnement.

Dependant de l'environnement, les genes vont s'exprimer differement.

Certain aes ne vont rien faire avec certain geoms. Par exemple, shape ne va rien faire avec geom_smooth et label ne va rien faire avec geom_point alors quil change tout avec geom_text! On voit ici en bas que maintenant on a des labels (l'age des gens) sur les points.

---

class: inverse center middle

# Stats

Le coeur du data scientist

---

## Statistiques

- On peut rajouter des statistiques sur les graphiques
    -   **smooth()** pour les courbes de tendances
    -   **summary()** pour les résumés statistiques
    -   **density()** pour les densités
    -   **ellipse()** pour les ellipses de confiance
    -   **qq()** pour les graphiques quantiles-quantiles
    -   et plein d'autres encore...
    
---

## Exemples


.pull-left[

- Les statistiques calculent de nouvelles variables à partir des données d'entrée. Les geoms ont des statistiques par défaut mais on peut les changer.



```{r , eval=FALSE, echo=TRUE}

ggplot(iris) + geom_bar(aes(x=Sepal.Length),
                        stat="bin")

ggplot(iris) + geom_bar(aes(x=Species),
                        stat="count")

ggplot(iris) + geom_bar(aes(x=Species,
                            y=Sepal.Length),
                        stat="identity")


```

]

.pull-right[

```{r ,  fig.align="left", out.width="500px", out.height="400px"}

x <- ggplot(iris) + geom_bar(aes(x=Sepal.Length),stat="bin")
y <- ggplot(iris) + geom_bar(aes(x=Species),stat="count")
z <- ggplot(iris) + geom_bar(aes(x=Species,y=Sepal.Length),stat="identity")
gridExtra::grid.arrange(x,y,z,nrow=1)

```

]

---

## Regression par pays (mais pour de vrai)

.pull-left[
```{r , eval=FALSE, echo=TRUE}
ggplot(df, aes(x=population, 
               y=suicides_no, 
               color=country)) +
geom_point() + 
geom_smooth(method="lm", formula=y~x)
# on rajoute une method a une formule


ggplot(df, aes(x=population, 
               y=suicides_no, 
               color=country)) +
geom_point() + 
geom_smooth()
# sinon par default geom_smooth() utilise
# method = 'loess' and formula = 'y ~ x'

```
]


.pull-right[

```{r ,  fig.align="left", out.width="500px", out.height="450px"}

x <- ggplot(df, aes(x=population, 
               y=suicides_no, 
               color=country)) +
      geom_point(alpha=0.3) + 
      geom_smooth(method="lm", formula=y~x) +
        custom_theme


y <- ggplot(df, aes(x=population, 
               y=suicides_no, 
               color=country)) +
      geom_point(alpha=0.3) + 
      geom_smooth() +
        custom_theme

gridExtra::grid.arrange(x,y,nrow=2)

```

]

<!--comments  -->
???

je vous ai "menti" un peu. La regression il y avait des arguments caché dans ma commande


---

class: inverse center middle

# Scales

To cut or no to cut

---

## Graphiques malhonnêtes


```{r, fig.align='center'}

url <- "https://static1.squarespace.com/static/55b6a6dce4b089e11621d3ed/55b6d08fe4b0d8b921b02f83/55b6d0a3e4b0d8b921b03574/1438044323461/1000w/"

image_link(url,url,width=600)

```

<!-- comments-->

???


Couper ou ne pas couper l'axe des Y est probablement l'un des sujets les plus controversés en matière de visualisation de données. Il y a clairement des acteurs malhonnetes qui vont couper l'axe des Y pour faire croire que les données sont plus importantes qu'elles ne le sont en réalité. Mais il y a aussi des cas où couper l'axe des Y est une bonne idée.

Quand est-ce que c'est une bonne idée de couper l'axe des Y? Bah en general avec les times series on veut montrer les tendances et pas les valeurs absolues. Donc on peut couper l'axe des Y pour montrer les tendances VS un baseline; Mais il faut le faire avec parcimonie et en indiquant clairement que l'axe est coupé.


barplot : Pour ce type de graphique, il existe un consensus : l'axe des ordonnées doit commencer à 0.
Lineplot: il n'y a pas de consensus, même si, en général, il n'est pas nécessaire de commencer à 0.


---

## Changer les échelles

.pull-left[

- On peut changer les échelles des axes
    -   **scale_x_log10()** pour une échelle logarithmique
    -   **scale_x_reverse()** pour inverser l'axe
    -   **scale_x_sqrt()** pour une échelle racine carrée


```{r , eval=FALSE, echo=TRUE}
ggplot(df, aes(x=population, 
               y=suicides_no)) +
geom_point(aes( color=country)) +
scale_x_log10() +
scale_y_log10() 
```
]

.pull-right[
```{r ,  fig.align="left", out.width="500px", out.height="400px"}

ggplot(df, aes(x=population, 
               y=suicides_no)) +
geom_point(aes( color=country), alpha=0.3) +
scale_x_log10() +
scale_y_log10() +
custom_theme

```

]

<!--comments -->
???
C'est hyper simple de changer les échelles des axes. Il suffit d'utiliser les fonctions scale_x_log10() et scale_y_log10() pour une échelle logarithmique, scale_x_reverse() pour inverser l'axe, scale_x_sqrt() pour une échelle racine carrée, etc.

---

class: inverse center middle

# Position

Comment positionner les geoms

---

## Position

.pull-left[

- On peut changer la position des geoms
    -   **dodge()** pour les barres côte à côte
    -   **jitter()** pour les points avec un peu de bruit
    -   **stack()** pour les barres empilées
    -   **position_identity()** pour les points
    -   et plein d'autres encore...

```{r , eval=FALSE, echo=TRUE}

ggplot(df,aes(x=age,y=suicides_no,fill=country))
 + geom_bar(stat="identity",position="stack")


ggplot(df,aes(x=age,y=suicides_no,fill=country))
 + geom_bar(stat="identity",position="dodge") 

```

]

.pull-right[
```{r ,  fig.align="left", out.width="500px", out.height="450px"}
df$age <- gsub(" years", "", df$age)
df$age <- factor(df$age, levels = c("5-14", "15-24", "25-34", "35-54", "55-74", "75+"))

p <- ggplot(df,aes(x=age,y=suicides_no,fill=country)) + custom_theme

x <- p + geom_bar(stat="identity",position="stack")
y <- p + geom_bar(stat="identity",position="dodge") 

gridExtra::grid.arrange(x,y, nrow=2)

```

]


---

## Jitter

.pull-left[


```{r , eval=FALSE, echo=TRUE}

#sans jitter / sans alpha
ggplot(df, aes(x=age, y=suicides_no, color=country)) +
  geom_point()





#avec jitter / avec alpha
ggplot(df, aes(x=age, y=suicides_no, color=country)) +
  geom_point(position="jitter", alpha=0.3) 

```

]


.pull-right[
```{r ,  fig.align="left", out.width="500px", out.height="450px"}

#sans jitter / sans alpha
x <- ggplot(df, aes(x=age, y=suicides_no, color=country)) +
  geom_point() +
  custom_theme


#avec jitter / avec alpha
y <- ggplot(df, aes(x=age, y=suicides_no, color=country)) +
  geom_point(position="jitter", alpha=0.3) +
  custom_theme

gridExtra::grid.arrange(x,y, nrow=2)

```

]

<!--comments -->
???
Premier est illisible est le second a deja pas mal plus de lisibilité


---

## Jitter + Boxplot / Violin

.pull-left[


```{r , eval=FALSE, echo=TRUE}

#jitter  + boxplot
ggplot(df, aes(x=age, y=suicides_no)) +
  geom_boxplot() +
  geom_point(position="jitter", alpha=0.3)

```

]


.pull-right[
```{r ,  fig.align="left", out.width="500px", out.height="450px"}

ggplot(df, aes(x=age, y=suicides_no)) +
  stat_boxplot(geom ='errorbar') + 
  geom_boxplot(outlier.shape = NA) +
  geom_point(position="jitter", alpha=0.3) + 
  custom_theme

```

]

<!--comments -->
???

Un des types de plots que j'utilise le plus pour explorer les données, très puissant et très simple à faire

---

class: inverse center middle

# Facets

---


## Facettes (Unidimensionnelles)


.pull-left[


```{r , eval=FALSE, echo=TRUE}


#meme echelle partout
ggplot(df, aes(x=age, y=suicides_no)) +
  geom_boxplot() +
  geom_point(position="jitter", alpha=0.3) +
  facet_wrap(~country)

#echelle libre
ggplot(df, aes(x=age, y=suicides_no)) +
  geom_boxplot() +
  geom_point(position="jitter", alpha=0.3) +
  facet_wrap(~country, scales = "free")

```

]

.pull-right[


```{r ,  fig.align="left", out.width="500px", out.height="450px"}

x <- ggplot(df, aes(x=age, y=suicides_no)) +
      geom_boxplot() +
      geom_point(position="jitter", alpha=0.3) +
      facet_wrap(~country) +
      custom_theme + 
       theme(axis.text.x = element_text(size = 9, angle = 90))

y <- ggplot(df, aes(x=age, y=suicides_no)) +
      geom_boxplot() +
      geom_point(position="jitter", alpha=0.3) +
      facet_wrap(~country, scales = "free") +
      custom_theme + 
       theme(axis.text.x = element_text(size = 9, angle = 90))


gridExtra::grid.arrange(x,y,nrow=2)

```

]


<!-- comments -->
???

- On peut faire des facettes
    -   **facet_wrap()** pour des facettes en une dimension
    

---


## Facettes (Multidimensionnelles: 2D)

.pull-left[

```{r , eval=FALSE, echo=TRUE}

ggplot(df, aes(x=age, y=suicides_no)) +
  geom_boxplot() +
  geom_point(position="jitter", alpha=0.3) +
  facet_grid(country~sex, scales = "free")

```

]

.pull-right[

```{r ,  fig.align="left", out.width="500px", out.height="450px"}

ggplot(df, aes(x=age, y=suicides_no)) +
  geom_boxplot() +
  geom_point(position="jitter", alpha=0.3) +
  facet_grid(country~sex, scales = "free") +
  custom_theme + 
  theme(axis.text.x = element_text(size = 9, angle = 90))

```

]


<!-- comments -->
???

- ou en deux dimensions
    -   **facet_grid()** 
la c'est juste un exemple, la j'ai mis les echelles en libre pour que ca soit plus lisible mais c'est pas forcement une bonne idée


---

class: inverse center middle

# Tout ensemble


---


## Mettons tout ensemble


On va essayer de poser la question: 

Comment peut-on visualiser une **comparaison par sexe** des tendances du **nombre de suicide** à travers **les années** dans **chaque pays** et dans chaque **groupe d'age**?

<br> 
<br> 
--
ggplot(**df**, aes(x=
--
 **year**, 
--
 y=
--
 **suicides_no**,
--
 color=
--
 **sex**)) +
--
<br>   geom_line() +
--
<br>   geom_smooth(method = 
--
 **"lm"**, se = FALSE)
--
 <br>   facet_grid(
--
 **country~age**, scales = "free") +




<!-- comment: -->
???

On peut ainsi voir une ligne de regression pour chaque groupe. Ce qui nous permet de voir clairement ce qui se passe avec le nombre de suicide a travers le temps dans chaque pays et dans chaque groupe d'age, et par sex.

Voila en 4 ligne, on peut obtenir une visualisation assez complexe et qui tient la route. Cela nous aurait pris beeeeaucoup plus de temps avec un approche tradtionnelle. et le pire c'est que si on finiissait avec cela avec une approche tradtionnelle cela serait encore hyper chiant de changer si on aime pas le resultat

J'espere que cet exemple vous montre l'interet des facettes, on peut faire des graphiques tres riches en information et tres lisibles. et cela montre aussi l´agilité du framework ggplot2


---


```{r ,  fig.align="center", out.width="650px"}

ggplot(df, aes(x=year, y=suicides_no,color=sex)) +
  geom_line() +
  geom_smooth(formula= 'y~x', method = "lm", se = FALSE) + 
  facet_grid(country~age, scales = "free") +
  custom_theme + 
  theme(axis.text.x = element_text(size = 9, angle = 90))


```

---

class: inverse center middle

# Travail Pratique 1: Base + graph design

---

## Suivez le guide!

### Ouvrez un script R ou Rmarkdown/Quarto

- Nous allons passer à la partie empirique dans laquelle nous allons créer un graphique basique.

- Une attention particulière sera donnée à tous les éléments que nous avons appris

- Nous parlerons aussi de l'utilité des labels

---

class: inverse center middle

# Travail Pratique 2: Documentation et reproduction de graphs


---

### Les étapes de la réalisation d'un graphique

Maintenant que nous avons les bases nous pouvons voir ce qui se passe dans les faits lorsqu'on souhaite faire un graphique:

--

1. Imaginer le graphique

    - Un croquis peut-être utile!
    
--
    
2. Choisir le graphique
    
--
    
3. Préparer les données: [dplyr](https://dplyr.tidyverse.org/reference/index.html) et [tidyr](https://tidyr.tidyverse.org/reference/index.html)
    
    - **dplyr**: `select()`, `filter()` / **tidyr**: `drop_na()`
    
--
    
4. Réaliser la structure de base

--
    
5. Améliorer

---

### 1. Imaginer le graphique

Il faut répondre aux questions suivantes:

1. Quelles sont les variables que je veux utiliser?

    - Type: Continues, catégorielles?
    
--
    
2. Qu'est-ce que je veux montrer?

    - Distribution? Composition? Relation? Comparaison? 
    
--
    
3. Qu'elle est l'histoire que je veux raconter?

    - Pourquoi ce graphique?
    
    - Qu'est-ce qui doit être mis en avant?

---

### 2. Choisir le graphique

.center[

```{r ,  fig.align="center"}
urlImage <- "https://www.labnol.org/images/2008/data-chart-type.png"
url <- "https://www.labnol.org/software/find-right-chart-type-for-your-data/6523/"
image_link(urlImage,url,width="650px")

```

]

---

### 4. Réaliser la structure de base 

*Ressources pour le choix du geom:*

 - [R Graph Gallery](https://r-graph-gallery.com/index.html)
 
### 5. Améliorer

- [R Graph Gallery ggplot2](https://r-graph-gallery.com/ggplot2-package.html)

- [ggplot2 function references](https://ggplot2.tidyverse.org/reference/)

---

class: center middle

# Exercice: reproduire les graphiques

**Ouvrir "Reproduire graphique exercice.qmd"**

---

class: inverse center middle

# Interactivité

le fun!

---

## Facile avec Plotly !


.pull-left[

```{r , eval=FALSE, echo=TRUE}
#creer le graphique
p <- ggplot(df, aes(x=population, y=suicides_no)) +
      geom_point(aes(color=country)) +
      geom_smooth() +
      custom_theme 

#envelopper dans ggplotly
plotly::ggplotly(p)
``` 

]


.pull-right[

```{r ,  fig.align="left", out.width="500px", out.height="450px"}

p <- ggplot(df, aes(x=population, y=suicides_no)) +
      geom_point(aes(color=country)) +
      geom_smooth() +
      custom_theme 


plotly::ggplotly(p)
``` 

]


<!-- comments -->
???

On va pas s'attarder la dessus car cela n'est pas le but de ce cours, mais je voulais vous montrer que c'est possible et que c'est facile.
- ggplotly() permet de transformer un graphique ggplot2 en graphique interactif

Pourquoi ? Cela peut etre tres utile pour explorer les donnees, et pour presenter les donnees a un public non technique! vraiment underatted a mon avis

---

class: inverse center middle

# Conclusions

En bref

---

## Avantages de ggplot2

<br><br>
- **Exploration agile des données** : itération rapide

- L'aesthétique permet de **superposer des hiérarchies** de caractéristiques

- Les géoms gèrent une grande partie des éléments complexes, ce qui **réduit les risques d'erreur**

- Domine l'approche traditionnelle pour les ensembles de données riches


<!-- comments -->
???

On arrive a la fin donc je voulais juste vous rappeler les avantages de la grammar of graphics.
Permet l'Exploration agile des données : itération rapide, on peut facilement changer les variables, les graphiques, les couleurs, les themes, etc.

Permetde Superposer des hiérarchies de caractéristiques: on peut superposer des variables, des facettes, des couleurs, des themes, etc.

Les géoms gèrent une grande partie des éléments complexes, ce qui réduit les risques d'erreur: on a vu que les geoms permettent de faire des graphiques complexes sans avoir a se soucier de la logique derriere

Finalement, ggplot2 domine l'approche traditionnelle pour les ensembles de données riches ET complexes

---



class: inverse center middle

# Ressources

.pull-left[

```{r ,  fig.align="center"}
urlImage <- "https://r4ds.hadley.nz/cover.jpg"
url <- "https://r4ds.hadley.nz/data-visualize.html"
image_link(urlImage,url,width="270px")
```
]



.pull-right[
```{r ,  fig.align="center"}
urlImage <- "https://m.media-amazon.com/images/I/51smGgbUUjL._SL1251_.jpg"
url <- "http://www.ievbras.ru/ecostat/Kiril/R/Biblio_N/R_Eng/Wickham2016.pdf"
image_link(urlImage,url,width="250px")

```
]

Et plus intéractif par Ben Baumer: <a href="https://mdsr-book.github.io/mdsr2e/index.html">
.white[`r icons::icon_style(icons::fontawesome("github"), fill = "white")` Modern Data Science with R]
</a>

<!--comments -->
???
- Hadley Wickham, le créateur de ggplot2, a écrit un livre sur la visualisation de données avec R, [R for Data Science](https://r4ds.had.co.nz/), qui est un excellent point de départ pour apprendre à utiliser ggplot2.

Par contre je conseillerais specialement de checker le ebook de Ben Baumer, qui est plus interactif et plus moderne. En plus je suis un peu biaiser car c'etait mon prof de stats a Smith College, et c'est lui qui ma introduit a R et ggplot2.

---

## Cheat sheet



```{r ,  fig.align="right"}
urlImage <- "./img/cheat.png"
url <- "https://www.maths.usyd.edu.au/u/UG/SM/STAT3022/r/current/Misc/data-visualization-2.1.pdf"
image_link(urlImage,url,width="650px")

```

<!-- Comments -->

???

Voici un cheat sheet pour ggplot2, qui resume les principales fonctions de ggplot2, juste cliquer dessus

---

## Web R Console


 <iframe src="https://munoztd0.shinyapps.io/Tuto_learnR_Data_Viz/" width="100%" height="500px" id="iframe1" marginheight="0" frameborder="0" onload='javascript:resizeIframe(this);'></iframe>
 
 
 <!-- Comments -->

???

Voici un lien vers une web R console, qui vous permet de tester ggplot2 en ligne, sans avoir a installer R sur votre ordinateur!
 
---
class: inverse center middle


# Thanks!

<a href="https://github.com/we-data-ch/TakeOver_Dataviz_R">
.white[`r icons::icon_style(icons::fontawesome("link"), fill = "white")` This presentation repository]
</a>

<a href="https://www.youtube.com/channel/UCGktdbvbc_H-JEkYYTvwRVw">
.white[`r icons::icon_style(icons::fontawesome("youtube"), fill = "white")` We Data YouTube]
</a>

<a href="mailto:david.munoz@mailbox.org">
.white[`r icons::icon_style(icons::fontawesome("paper-plane"), fill = "white")` david.munoz@mailbox.org]
</a>

<a href="http://twitter.com/tord_munoz">
.white[`r icons::icon_style(icons::fontawesome("twitter"), fill = "white")` @tord_munoz]
</a>

<a href="https://github.com/munoztd0">
.white[`r icons::icon_style(icons::fontawesome("github"), fill = "white")` @munoztd0]
</a>

.pull-left[

<a href="mailto:Ivan.Lorenci@etu.unige.ch">
.white[`r icons::icon_style(icons::fontawesome("paper-plane"), fill = "white")` Ivan.Lorenci@etu.unige.ch]
</a>

<a href="http://twitter.com/IvanLdF">
.white[`r icons::icon_style(icons::fontawesome("twitter"), fill = "white")` @IvanLdF]
</a>

<a href="https://github.com/ivanldf13">
.white[`r icons::icon_style(icons::fontawesome("github"), fill = "white")` @ivanldf13]
</a>

]

.pull-right[

<a href="mailto:vestin.hategekimana@unige.ch">
.white[`r icons::icon_style(icons::fontawesome("paper-plane"), fill = "white")` vestin.hategekimana@unige.ch]
</a>

<a href="http://twitter.com/PEcodemo">
.white[`r icons::icon_style(icons::fontawesome("twitter"), fill = "white")` @PEcodemo]
</a>

<a href="https://github.com/CyuHat">
.white[`r icons::icon_style(icons::fontawesome("github"), fill = "white")` @CyuHat]
</a>

]

<br>

Slides created via the R packages:

*xaringan* and *xaringanthemer*

<!-- Comments -->

???


Si vous avez des questions, n'hesitez pas a me les poser maintenant ou nous contacter par mail, sur twitter, ou sur github!

D'ailleurs ici vous avez le lien github du repo de cette presentation, et le lien vers notre chaine youtube, ou vous pouvez trouver des tutoriels sur R et sur d'autres sujets!


